'''
Created on 2015. 2. 28.

@author: daehyun
'''

from urllib2 import Request, urlopen, URLError
from datetime import datetime

file_name = datetime.now().strftime('%Y-%m-%d-%H-%M-%S');



pw_species = ""
#human_pw = 'http://identifiers.org/reactome/REACT_238.2,Amino acid synthesis and interconversion (transamination),http://identifiers.org/reactome/REACT_115789.1,Serine biosynthesis','http://identifiers.org/reactome/REACT_1213.5,Apoptosis induced DNA fragmentation,http://identifiers.org/reactome/REACT_13462.2,Activation of DNA fragmentation factor','http://identifiers.org/reactome/REACT_22258.3,Metabolism of lipids and lipoproteins,http://identifiers.org/reactome/REACT_147797.3,Regulation of cholesterol biosynthesis by SREBP (SREBF)','http://identifiers.org/reactome/REACT_22258.3,Metabolism of lipids and lipoproteins,http://identifiers.org/reactome/REACT_19323.4,Sphingolipid metabolism','http://identifiers.org/reactome/REACT_22258.3,Metabolism of lipids and lipoproteins,http://identifiers.org/reactome/REACT_11040.2,Bile acid and bile salt metabolism','http://identifiers.org/reactome/REACT_22258.3,Metabolism of lipids and lipoproteins,http://identifiers.org/reactome/REACT_120870.2,Phospholipid metabolism','http://identifiers.org/reactome/REACT_22258.3,Metabolism of lipids and lipoproteins,http://identifiers.org/reactome/REACT_11057.4,Metabolism of steroid hormones and vitamin D','http://identifiers.org/reactome/REACT_22258.3,Metabolism of lipids and lipoproteins,http://identifiers.org/reactome/REACT_160111.2,Ubiquinol biosynthesis','http://identifiers.org/reactome/REACT_22258.3,Metabolism of lipids and lipoproteins,http://identifiers.org/reactome/REACT_147851.3,Arachidonic acid metabolism','http://identifiers.org/reactome/REACT_22258.3,Metabolism of lipids and lipoproteins,http://identifiers.org/reactome/REACT_22279.2,"Fatty acid, triacylglycerol, and ketone body metabolism"','http://identifiers.org/reactome/REACT_22258.3,Metabolism of lipids and lipoproteins,http://identifiers.org/reactome/REACT_9405.3,Cholesterol biosynthesis','http://identifiers.org/reactome/REACT_22258.3,Metabolism of lipids and lipoproteins,http://identifiers.org/reactome/REACT_121284.2,alpha-linolenic (omega3) and linoleic (omega6) acid metabolism','http://identifiers.org/reactome/REACT_22258.3,Metabolism of lipids and lipoproteins,http://identifiers.org/reactome/REACT_16957.2,Peroxisomal lipid metabolism','http://identifiers.org/reactome/REACT_22258.3,Metabolism of lipids and lipoproteins,http://identifiers.org/reactome/REACT_602.8,Lipid and lipoprotein metabolism','http://identifiers.org/reactome/REACT_147797.3,Regulation of cholesterol biosynthesis by SREBP (SREBF),http://identifiers.org/reactome/REACT_147904.3,Activation of gene expression by SREBF (SREBP)','http://identifiers.org/reactome/REACT_19323.4,Sphingolipid metabolism,http://identifiers.org/reactome/REACT_116105.3,Glycosphingolipid metabolism','http://identifiers.org/reactome/REACT_19323.4,Sphingolipid metabolism,http://identifiers.org/reactome/REACT_115810.1,Sphingolipid de novo biosynthesis','http://identifiers.org/reactome/REACT_11040.2,Bile acid and bile salt metabolism,http://identifiers.org/reactome/REACT_11054.1,Synthesis of bile acids and bile salts','http://identifiers.org/reactome/REACT_11040.2,Bile acid and bile salt metabolism,http://identifiers.org/reactome/REACT_11042.2,Recycling of bile acids and salts','http://identifiers.org/reactome/REACT_120870.2,Phospholipid metabolism,http://identifiers.org/reactome/REACT_121175.2,PI Metabolism','http://identifiers.org/reactome/REACT_120870.2,Phospholipid metabolism,http://identifiers.org/reactome/REACT_121401.2,Glycerophospholipid biosynthesis','http://identifiers.org/reactome/REACT_11057.4,Metabolism of steroid hormones and vitamin D,http://identifiers.org/reactome/REACT_13523.4,Vitamin D (calciferol) metabolism','http://identifiers.org/reactome/REACT_11057.4,Metabolism of steroid hormones and vitamin D,http://identifiers.org/reactome/REACT_11038.4,Pregnenolone biosynthesis','http://identifiers.org/reactome/REACT_11057.4,Metabolism of steroid hormones and vitamin D,http://identifiers.org/reactome/REACT_11037.3,Estrogen biosynthesis','http://identifiers.org/reactome/REACT_11057.4,Metabolism of steroid hormones and vitamin D,http://identifiers.org/reactome/REACT_11036.3,Glucocorticoid biosynthesis','http://identifiers.org/reactome/REACT_11057.4,Metabolism of steroid hormones and vitamin D,http://identifiers.org/reactome/REACT_11047.3,Mineralocorticoid biosynthesis','http://identifiers.org/reactome/REACT_11057.4,Metabolism of steroid hormones and vitamin D,http://identifiers.org/reactome/REACT_11059.3,Androgen biosynthesis','http://identifiers.org/reactome/REACT_147851.3,Arachidonic acid metabolism,http://identifiers.org/reactome/REACT_150320.2,Synthesis of Lipoxins (LX)','http://identifiers.org/reactome/REACT_147851.3,Arachidonic acid metabolism,http://identifiers.org/reactome/REACT_150292.2,Synthesis of Hepoxilins (HX) and Trioxilins (TrX)','http://identifiers.org/reactome/REACT_147851.3,Arachidonic acid metabolism,http://identifiers.org/reactome/REACT_150149.2,Synthesis of Prostaglandins (PG) and Thromboxanes (TX)','http://identifiers.org/reactome/REACT_147851.3,Arachidonic acid metabolism,http://identifiers.org/reactome/REACT_150134.2,Synthesis of (16-20)-hydroxyeicosatetraenoic acids (HETE)','http://identifiers.org/reactome/REACT_147851.3,Arachidonic acid metabolism,http://identifiers.org/reactome/REACT_150420.2,Synthesis of Leukotrienes (LT) and Eoxins (EX)','http://identifiers.org/reactome/REACT_147851.3,Arachidonic acid metabolism,http://identifiers.org/reactome/REACT_150422.2,Synthesis of 15-eicosatetraenoic acid derivatives','http://identifiers.org/reactome/REACT_147851.3,Arachidonic acid metabolism,http://identifiers.org/reactome/REACT_150417.2,Synthesis of epoxy (EET) and dihydroxyeicosatrienoic acids (DHET)','http://identifiers.org/reactome/REACT_147851.3,Arachidonic acid metabolism,http://identifiers.org/reactome/REACT_150209.2,Synthesis of 5-eicosatetraenoic acids','http://identifiers.org/reactome/REACT_147851.3,Arachidonic acid metabolism,http://identifiers.org/reactome/REACT_150201.2,Synthesis of 12-eicosatetraenoic acid derivatives','http://identifiers.org/reactome/REACT_22279.2,"Fatty acid, triacylglycerol, and ketone body metabolism",http://identifiers.org/reactome/REACT_19241.3,Regulation of lipid metabolism by Peroxisome proliferator-activated receptor alpha (PPARalpha)','http://identifiers.org/reactome/REACT_22279.2,"Fatty acid, triacylglycerol, and ketone body metabolism",http://identifiers.org/reactome/REACT_1861.4,Ketone body metabolism','http://identifiers.org/reactome/REACT_22279.2,"Fatty acid, triacylglycerol, and ketone body metabolism",http://identifiers.org/reactome/REACT_1190.3,Triglyceride Biosynthesis','http://identifiers.org/reactome/REACT_22279.2,"Fatty acid, triacylglycerol, and ketone body metabolism",http://identifiers.org/reactome/REACT_11082.3,Import of palmitoyl-CoA into the mitochondrial matrix','http://identifiers.org/reactome/REACT_22279.2,"Fatty acid, triacylglycerol, and ketone body metabolism",http://identifiers.org/reactome/REACT_1473.1,Mitochondrial Fatty Acid Beta-Oxidation','http://identifiers.org/reactome/REACT_121284.2,alpha-linolenic (omega3) and linoleic (omega6) acid metabolism,http://identifiers.org/reactome/REACT_121100.2,Linoleic acid (LA) metabolism','http://identifiers.org/reactome/REACT_121284.2,alpha-linolenic (omega3) and linoleic (omega6) acid metabolism,http://identifiers.org/reactome/REACT_121147.2,alpha-linolenic acid (ALA) metabolism','http://identifiers.org/reactome/REACT_16957.2,Peroxisomal lipid metabolism,http://identifiers.org/reactome/REACT_16904.1,NADPH regeneration','http://identifiers.org/reactome/REACT_16957.2,Peroxisomal lipid metabolism,http://identifiers.org/reactome/REACT_17062.1,Beta-oxidation of very long chain fatty acids','http://identifiers.org/reactome/REACT_16957.2,Peroxisomal lipid metabolism,http://identifiers.org/reactome/REACT_17003.1,Alpha-oxidation of phytanate','http://identifiers.org/reactome/REACT_16957.2,Peroxisomal lipid metabolism,http://identifiers.org/reactome/REACT_17017.1,Beta-oxidation of pristanoyl-CoA','http://identifiers.org/reactome/REACT_16957.2,Peroxisomal lipid metabolism,http://identifiers.org/reactome/REACT_1407.3,Plasmalogen biosynthesis','http://identifiers.org/reactome/REACT_602.8,Lipid and lipoprotein metabolism,http://identifiers.org/reactome/REACT_6823.1,Lipoprotein metabolism','http://identifiers.org/reactome/REACT_602.8,Lipid and lipoprotein metabolism,http://identifiers.org/reactome/REACT_494.1,Hormone-sensitive lipase (HSL)-mediated triacylglycerol hydrolysis','http://identifiers.org/reactome/REACT_602.8,Lipid and lipoprotein metabolism,http://identifiers.org/reactome/REACT_9518.2,Digestion of dietary lipid','http://identifiers.org/reactome/REACT_602.8,Lipid and lipoprotein metabolism,http://identifiers.org/reactome/REACT_13781.2,Trafficking of dietary sterols','http://identifiers.org/reactome/REACT_111155.1,Cell-Cell communication,http://identifiers.org/reactome/REACT_23916.1,Signal regulatory protein (SIRP) family interactions','http://identifiers.org/reactome/REACT_111155.1,Cell-Cell communication,http://identifiers.org/reactome/REACT_20676.1,Cell junction organization','http://identifiers.org/reactome/REACT_111155.1,Cell-Cell communication,http://identifiers.org/reactome/REACT_25299.1,DSCAM interactions','http://identifiers.org/reactome/REACT_111155.1,Cell-Cell communication,http://identifiers.org/reactome/REACT_23832.2,Nephrin interactions','http://identifiers.org/reactome/REACT_20676.1,Cell junction organization,http://identifiers.org/reactome/REACT_19331.2,Cell-cell junction organization','http://identifiers.org/reactome/REACT_20676.1,Cell junction organization,http://identifiers.org/reactome/REACT_20649.1,Cell-extracellular matrix interactions','http://identifiers.org/reactome/REACT_20676.1,Cell junction organization,http://identifiers.org/reactome/REACT_20537.1,Type I hemidesmosome assembly','http://identifiers.org/reactome/REACT_118572.6,Degradation of the extracellular matrix,http://identifiers.org/reactome/REACT_150401.3,Collagen degradation','http://identifiers.org/reactome/REACT_118572.6,Degradation of the extracellular matrix,http://identifiers.org/reactome/REACT_118682.2,Activation of Matrix Metalloproteinases','http://identifiers.org/reactome/REACT_471.3,E2F mediated regulation of DNA replication,http://identifiers.org/reactome/REACT_1321.2,E2F-enabled inhibition of pre-replication complex formation','http://identifiers.org/reactome/REACT_471.3,E2F mediated regulation of DNA replication,http://identifiers.org/reactome/REACT_329.3,Inhibition of replication initiation of damaged DNA by RB1/E2F1','http://identifiers.org/reactome/REACT_13685.3,Neuronal System,http://identifiers.org/reactome/REACT_13477.2,Transmission across Chemical Synapses','http://identifiers.org/reactome/REACT_13685.3,Neuronal System,http://identifiers.org/reactome/REACT_75908.1,Potassium Channels','http://identifiers.org/reactome/REACT_13685.3,Neuronal System,http://identifiers.org/reactome/REACT_16881.2,Transmission across Electrical Synapses','http://identifiers.org/reactome/REACT_13477.2,Transmission across Chemical Synapses,http://identifiers.org/reactome/REACT_13594.2,Neurotransmitter uptake and Metabolism In Glial Cells','http://identifiers.org/reactome/REACT_13477.2,Transmission across Chemical Synapses,http://identifiers.org/reactome/REACT_13583.2,Neurotransmitter Clearance In The Synaptic Cleft','http://identifiers.org/reactome/REACT_13477.2,Transmission across Chemical Synapses,http://identifiers.org/reactome/REACT_13606.2,Depolarization of the Presynaptic Terminal Triggers the Opening of Calcium Channels','http://identifiers.org/reactome/REACT_13477.2,Transmission across Chemical Synapses,http://identifiers.org/reactome/REACT_13723.2,Neurotransmitter Release Cycle','http://identifiers.org/reactome/REACT_13477.2,Transmission across Chemical Synapses,http://identifiers.org/reactome/REACT_15370.2,Neurotransmitter Receptor Binding And Downstream Transmission In The Postsynaptic Cell','http://identifiers.org/reactome/REACT_75908.1,Potassium Channels,http://identifiers.org/reactome/REACT_75770.1,Voltage gated Potassium channels','http://identifiers.org/reactome/REACT_75908.1,Potassium Channels,http://identifiers.org/reactome/REACT_75897.1,Tandem pore domain potassium channels','http://identifiers.org/reactome/REACT_75908.1,Potassium Channels,http://identifiers.org/reactome/REACT_75896.1,Ca activated K+ channels','http://identifiers.org/reactome/REACT_75908.1,Potassium Channels,http://identifiers.org/reactome/REACT_75918.1,Inwardly rectifying K+ channels','http://identifiers.org/reactome/REACT_75908.1,Potassium Channels,http://identifiers.org/reactome/REACT_75862.1,HCN channels','http://identifiers.org/reactome/REACT_16881.2,Transmission across Electrical Synapses,http://identifiers.org/reactome/REACT_16970.1,Electric Transmission Across Gap Junctions','http://identifiers.org/reactome/REACT_147749.2,MPS IIID - Sanfilippo syndrome D,http://identifiers.org/reactome/REACT_121315.2,Glycosaminoglycan metabolism','http://identifiers.org/reactome/REACT_121315.2,Glycosaminoglycan metabolism,http://identifiers.org/reactome/REACT_6840.4,Transport and synthesis of PAPS','http://identifiers.org/reactome/REACT_121315.2,Glycosaminoglycan metabolism,http://identifiers.org/reactome/REACT_121288.2,Keratan sulfate/keratin metabolism','http://identifiers.org/reactome/REACT_121315.2,Glycosaminoglycan metabolism,http://identifiers.org/reactome/REACT_121314.2,Heparan sulfate/heparin (HS-GAG) metabolism','http://identifiers.org/reactome/REACT_121315.2,Glycosaminoglycan metabolism,http://identifiers.org/reactome/REACT_121206.2,Chondroitin sulfate/dermatan sulfate metabolism','http://identifiers.org/reactome/REACT_121315.2,Glycosaminoglycan metabolism,http://identifiers.org/reactome/REACT_121083.2,Hyaluronan metabolism','http://identifiers.org/reactome/REACT_474.7,Carbohydrate metabolism,http://identifiers.org/reactome/REACT_121315.2,Glycosaminoglycan metabolism','http://identifiers.org/reactome/REACT_474.7,Carbohydrate metabolism,http://identifiers.org/reactome/REACT_9472.2,Digestion of dietary carbohydrate','http://identifiers.org/reactome/REACT_474.7,Carbohydrate metabolism,http://identifiers.org/reactome/REACT_723.4,Glucose metabolism','http://identifiers.org/reactome/REACT_474.7,Carbohydrate metabolism,http://identifiers.org/reactome/REACT_1571.3,Fructose catabolism','http://identifiers.org/reactome/REACT_474.7,Carbohydrate metabolism,http://identifiers.org/reactome/REACT_9441.2,Hexose uptake','http://identifiers.org/reactome/REACT_474.7,Carbohydrate metabolism,http://identifiers.org/reactome/REACT_1859.2,Pentose phosphate pathway (hexose monophosphate shunt)','http://identifiers.org/reactome/REACT_474.7,Carbohydrate metabolism,http://identifiers.org/reactome/REACT_532.3,Galactose catabolism','http://identifiers.org/reactome/REACT_474.7,Carbohydrate metabolism,http://identifiers.org/reactome/REACT_850.6,PRPP biosynthesis','http://identifiers.org/reactome/REACT_723.4,Glucose metabolism,http://identifiers.org/reactome/REACT_1008.2,Glycogen breakdown (glycogenolysis)','http://identifiers.org/reactome/REACT_723.4,Glucose metabolism,http://identifiers.org/reactome/REACT_1383.7,Glycolysis','http://identifiers.org/reactome/REACT_723.4,Glucose metabolism,http://identifiers.org/reactome/REACT_1520.4,Gluconeogenesis','http://identifiers.org/reactome/REACT_723.4,Glucose metabolism,http://identifiers.org/reactome/REACT_169208.2,Glycogen synthesis','http://identifiers.org/reactome/REACT_9441.2,Hexose uptake,http://identifiers.org/reactome/REACT_212.5,Glucose transport','http://identifiers.org/reactome/REACT_25208.1,N-glycan antennae elongation in the medial/trans-Golgi,http://identifiers.org/reactome/REACT_25266.1,Reactions specific to the hybrid N-glycan synthesis pathway','http://identifiers.org/reactome/REACT_25208.1,N-glycan antennae elongation in the medial/trans-Golgi,http://identifiers.org/reactome/REACT_25085.1,N-Glycan antennae elongation','http://identifiers.org/reactome/REACT_25208.1,N-glycan antennae elongation in the medial/trans-Golgi,http://identifiers.org/reactome/REACT_25302.1,Reactions specific to the complex N-glycan synthesis pathway','http://identifiers.org/reactome/REACT_6167.4,Influenza Infection,http://identifiers.org/reactome/REACT_6323.4,Host Interactions with Influenza Factors'
species_query = "https://www.ebi.ac.uk/rdf/services/reactome/servlet/query?query=PREFIX%20rdf%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX%20rdfs%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX%20owl%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2002%2F07%2Fowl%23%3E%0D%0APREFIX%20xsd%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema%23%3E%0D%0APREFIX%20dc%3A%20%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Felements%2F1.1%2F%3E%0D%0APREFIX%20dcterms%3A%20%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Fterms%2F%3E%0D%0APREFIX%20foaf%3A%20%3Chttp%3A%2F%2Fxmlns.com%2Ffoaf%2F0.1%2F%3E%0D%0APREFIX%20skos%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0D%0APREFIX%20biopax3%3A%20%3Chttp%3A%2F%2Fwww.biopax.org%2Frelease%2Fbiopax-level3.owl%23%3E%0D%0A%0D%0ASELECT%20DISTINCT%20%3Forg%20%3Forgname%0D%0AWHERE%20%0D%0A%7B%0D%0A%20%3Fpathway%20rdf%3Atype%20biopax3%3APathway%20.%0D%0A%20%3Fpathway%20biopax3%3AdisplayName%20%3Fpathwayname.%0D%0A%20%3Fpathway%20biopax3%3Aorganism%20%3Forg.%0D%0A%20%20%3Forg%20biopax3%3Aname%20%3Forgname.%0D%0A%0D%0A%7D&format=CSV&limit=100&offset=0&inference=false"
species_pw = "https://www.ebi.ac.uk/rdf/services/reactome/servlet/query?query=PREFIX%20rdf%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX%20rdfs%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX%20owl%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2002%2F07%2Fowl%23%3E%0D%0APREFIX%20xsd%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema%23%3E%0D%0APREFIX%20dc%3A%20%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Felements%2F1.1%2F%3E%0D%0APREFIX%20dcterms%3A%20%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Fterms%2F%3E%0D%0APREFIX%20foaf%3A%20%3Chttp%3A%2F%2Fxmlns.com%2Ffoaf%2F0.1%2F%3E%0D%0APREFIX%20skos%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0D%0APREFIX%20biopax3%3A%20%3Chttp%3A%2F%2Fwww.biopax.org%2Frelease%2Fbiopax-level3.owl%23%3E%0D%0A%0D%0ASELECT%20DISTINCT%20%3Fpathway%20%3Fpathwayname%20%3Fsubpath%20%3Fsubpathname%0D%0AWHERE%20%0D%0A%7B%0D%0A%20%3Fpathway%20rdf%3Atype%20biopax3%3APathway%20.%0D%0A%20%3Fpathway%20biopax3%3AdisplayName%20%3Fpathwayname.%0D%0A%20%3Fpathway%20biopax3%3Aorganism%20%3Forg.%0D%0A%20%20%3Forg%20biopax3%3Aname%20%3Forgname.%0D%0A%20%20%3Fpathway%20biopax3%3ApathwayComponent%20%3Fsubpath.%0D%0A%20%20%3Fsubpath%20biopax3%3AdisplayName%20%3Fsubpathname.%0D%0A%20%20%0D%0A%20%20filter(%3Forg%20%3D%20%3Chttp%3A%2F%2Fidentifiers.org%2Ftaxonomy%2F","%3E)%0D%0A%0D%0A%7D&format=CSV&inference=false"

species_req = Request(species_query)
species_res = urlopen(species_req)
species_list = species_res.read()

species_list = species_list[13:].replace("\r","").split("\n")
for i in range(0, len(species_list)):
    species_list[i] = species_list[i].split(",")
    species_list[i][0] = species_list[i][0].replace("http://identifiers.org/taxonomy/","")

for cur_sp in species_list:
    
    species_pw_query = species_pw[0]+cur_sp[0]+species_pw[1]
    sp_req = Request(species_pw_query)
    try:
        sp_res = urlopen(sp_req)
        species_pw_list = sp_res.read()
        species_pw_list = species_pw_list[41:].replace("\r","").split("\n")
        
        print species_pw_list
        
        for p in range(0,len(species_pw_list)-1):
            species_pw_list[p] = species_pw_list[p].split(",")
            species_pw_list[p][0] = species_pw_list[p][0].replace("http://identifiers.org/reactome/","")
            species_pw_list[p][2] = species_pw_list[p][2].replace("http://identifiers.org/reactome/","")
        
        for i in species_pw_list:
            print i
        # 1 - main pw id 2- main pw name 3- sub pw id 4- sub pw name
        
        #query_sparql = "https://www.ebi.ac.uk/rdf/services/reactome/servlet/query?query=PREFIX%20rdf%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX%20rdfs%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX%20owl%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2002%2F07%2Fowl%23%3E%0D%0APREFIX%20xsd%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema%23%3E%0D%0APREFIX%20dc%3A%20%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Felements%2F1.1%2F%3E%0D%0APREFIX%20dcterms%3A%20%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Fterms%2F%3E%0D%0APREFIX%20foaf%3A%20%3Chttp%3A%2F%2Fxmlns.com%2Ffoaf%2F0.1%2F%3E%0D%0APREFIX%20skos%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0D%0APREFIX%20biopax3%3A%20%3Chttp%3A%2F%2Fwww.biopax.org%2Frelease%2Fbiopax-level3.owl%23%3E%0D%0A%0D%0ASELECT%20DISTINCT%20%3Fpmid%0D%0AWHERE%20%0D%0A%7B%0D%0A%20%3Fpathway%20rdf%3Atype%20biopax3%3APathway%20.%0D%0A%20%3Fpathway%20biopax3%3AdisplayName%20%3Fpathwayname.%0D%0A%20%3Fpathway%20biopax3%3Aorganism%20%3Forg.%0D%0A%20%20%3Forg%20biopax3%3Aname%20%3Forgname.%0D%0A%20%20%0D%0A%20%20%7B%3Fsubcomponent%20biopax3%3Aevidence%20%3Fevidencelist.%7D%0D%0A%20%20UNION%0D%0A%20%20%7B%3Fpathway%20biopax3%3Aevidence%20%3Fevidencelist.%20%7D%0D%0A%0D%0A%20%20%7B%3Fevidencelist%20biopax3%3Axref%20%3Fpub.%7D%0D%0A%20%20UNION%0D%0A%20%20%7B%3Fsubcomponent%20biopax3%3Axref%20%3Fpub.%20%7D%0D%0A%20%20UNION%0D%0A%20%20%7B%3Fpathway%20biopax3%3Axref%20%3Fpub.%20%7D%0D%0A%20%20%0D%0A%20%20%7B%3Fpathway%20biopax3%3ApathwayComponent%20%3Fsubcomponent.%7D%0D%0A%20%20UNION%0D%0A%20%20%7B%3Fsubcompoent%20biopax3%3ApathwayComponent%20%3Fsubcomponent.%7D%0D%0A%20%20%0D%0A%20%20%3Fpub%20rdf%3Atype%20biopax3%3APublicationXref.%0D%0A%20%20%3Fpub%20biopax3%3Adb%20%3Fpub_db.%0D%0A%20%20%3Fpub%20biopax3%3Aid%20%3Fpmid%0D%0A%20%20FILTER%20regex(%3Fpub_db%2C%22Pubmed%22).%0D%0A%20%20FILTER%20(%3Fpathway%20%3D%20%3Chttp%3A%2F%2Fidentifiers.org%2Freactome%2F","%3E).%0D%0A%20%20%0D%0A%7D&format=CSV&limit=100&offset=0&inference=false";
        #query_sparql = "https://www.ebi.ac.uk/rdf/services/reactome/servlet/query?query=PREFIX%20rdf%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX%20rdfs%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX%20owl%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2002%2F07%2Fowl%23%3E%0D%0APREFIX%20xsd%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema%23%3E%0D%0APREFIX%20dc%3A%20%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Felements%2F1.1%2F%3E%0D%0APREFIX%20dcterms%3A%20%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Fterms%2F%3E%0D%0APREFIX%20foaf%3A%20%3Chttp%3A%2F%2Fxmlns.com%2Ffoaf%2F0.1%2F%3E%0D%0APREFIX%20skos%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0D%0APREFIX%20biopax3%3A%20%3Chttp%3A%2F%2Fwww.biopax.org%2Frelease%2Fbiopax-level3.owl%23%3E%0D%0A%0D%0ASELECT%20DISTINCT%20%3Fpmid%0D%0AWHERE%20%0D%0A%7B%0D%0A%20%3Fpathway%20rdf%3Atype%20biopax3%3APathway%20.%0D%0A%20%3Fpathway%20biopax3%3AdisplayName%20%3Fpathwayname.%0D%0A%20%3Fpathway%20biopax3%3Aorganism%20%3Forg.%0D%0A%20%20%3Forg%20biopax3%3Aname%20%3Forgname.%0D%0A%20%20%0D%0A%20%20%7B%3Fpathway%20biopax3%3ApathwayComponent%20%3Fsubcomponent%7D%0D%0A%20%20UNION%0D%0A%20%20%7B%3Fsubcomponent%20biopax3%3ApathwayComponent%20%3Fsubcomponent%7D%0D%0A%20%20%0D%0A%20%20%7B%3Fsubcomponent%20biopax3%3Axref%20%3Fpub%7D%0D%0A%20%20UNION%0D%0A%20%20%7B%3Fpathway%20biopax3%3Axref%20%3Fpub%7D%0D%0A%20%20%0D%0A%20%20%0D%0A%20%20%3Fpub%20rdf%3Atype%20biopax3%3APublicationXref.%0D%0A%20%20%3Fpub%20biopax3%3Adb%20%3Fpub_db.%0D%0A%20%20%3Fpub%20biopax3%3Aid%20%3Fpmid.%0D%0A%20%20FILTER%20regex(%3Fpub_db%2C%22Pubmed%22).%0D%0A%20%20FILTER%20(%3Fpathway%20%3D%20%20%3Chttp%3A%2F%2Fidentifiers.org%2Freactome%2F","%3E).%0D%0A%20%20%0D%0A%7D&format=CSV&limit=100&offset=0&inference=false"
        #query_sparql = "https://www.ebi.ac.uk/rdf/services/reactome/servlet/query?query=PREFIX%20rdf%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX%20rdfs%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX%20owl%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2002%2F07%2Fowl%23%3E%0D%0APREFIX%20xsd%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema%23%3E%0D%0APREFIX%20dc%3A%20%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Felements%2F1.1%2F%3E%0D%0APREFIX%20dcterms%3A%20%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Fterms%2F%3E%0D%0APREFIX%20foaf%3A%20%3Chttp%3A%2F%2Fxmlns.com%2Ffoaf%2F0.1%2F%3E%0D%0APREFIX%20skos%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0D%0APREFIX%20biopax3%3A%20%3Chttp%3A%2F%2Fwww.biopax.org%2Frelease%2Fbiopax-level3.owl%23%3E%0D%0A%0D%0A%23SELECT%20DISTINCT%20%3Fsubcomponent%20%3Fevidencelist%0D%0ASELECT%20DISTINCT%20%3Fpmid%0D%0AWHERE%20%0D%0A%7B%0D%0A%20%3Fpathway%20rdf%3Atype%20biopax3%3APathway%20.%0D%0A%20%3Fpathway%20biopax3%3AdisplayName%20%3Fpathwayname.%0D%0A%20%3Fpathway%20biopax3%3Aorganism%20%3Forg.%0D%0A%20%20%3Forg%20biopax3%3Aname%20%3Forgname.%0D%0A%20%20%0D%0A%20%20%7B%3Fpathway%20biopax3%3ApathwayComponent%20%3Fsubcomponent%7D%0D%0A%20%20UNION%0D%0A%20%20%7B%3Fsubcomponent%20biopax3%3ApathwayComponent%20%3Fsubcomponent%7D%0D%0A%20%0D%0A%20%20%20%20%20%20%7BOPTIONAL%7B%3Fsubcomponent%20biopax3%3Aevidence%20%3Fevidencelist%7D%7D%0D%0A%20%20%20%20%09UNION%0D%0A%20%20%20%20%20%20%7BOPTIONAL%7B%3Fpathway%20biopax3%3Aevidence%20%3Fevidencelist%7D%7D%0D%0A%20%0D%0A%20%20%20%20%20%20%7BOPTIONAL%7B%3Fevidencelist%20biopax3%3Axref%20%3Fpub%7D.%7D%0D%0A%20%20%20%20%20%20UNION%0D%0A%20%20%20%20%20%20%7BOPTIONAL%7B%3Fsubcomponent%20biopax3%3Axref%20%3Fpub%7D.%7D%0D%0A%20%20%20%20%20%20UNION%0D%0A%20%20%20%20%20%20%7BOPTIONAL%7B%3Fpathway%20biopax3%3Axref%20%3Fpub%7D.%7D%0D%0A%20%20%0D%0A%20%20%3Fpub%20rdf%3Atype%20biopax3%3APublicationXref.%0D%0A%20%20%3Fpub%20biopax3%3Adb%20%3Fpub_db.%0D%0A%20%20%3Fpub%20biopax3%3Aid%20%3Fpmid.%0D%0A%20%20FILTER%20regex(%3Fpub_db%2C%22Pubmed%22).%0D%0A%20%20FILTER%20(%3Fpathway%20%3D%20%20%3Chttp%3A%2F%2Fidentifiers.org%2Freactome%2F","%3E).%0D%0A%20%20%0D%0A%7D&format=CSV&limit=100&offset=0&inference=false"
        query_sparql = "https://www.ebi.ac.uk/rdf/services/reactome/servlet/query?query=PREFIX%20rdf%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX%20rdfs%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX%20owl%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2002%2F07%2Fowl%23%3E%0D%0APREFIX%20xsd%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema%23%3E%0D%0APREFIX%20dc%3A%20%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Felements%2F1.1%2F%3E%0D%0APREFIX%20dcterms%3A%20%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Fterms%2F%3E%0D%0APREFIX%20foaf%3A%20%3Chttp%3A%2F%2Fxmlns.com%2Ffoaf%2F0.1%2F%3E%0D%0APREFIX%20skos%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0D%0APREFIX%20biopax3%3A%20%3Chttp%3A%2F%2Fwww.biopax.org%2Frelease%2Fbiopax-level3.owl%23%3E%0D%0A%0D%0ASELECT%20DISTINCT%20%3Fpmid%0D%0AWHERE%20%0D%0A%7B%0D%0A%20%3Fpathway%20rdf%3Atype%20biopax3%3APathway%20.%0D%0A%20%3Fpathway%20biopax3%3AdisplayName%20%3Fpathwayname.%0D%0A%20%3Fpathway%20biopax3%3Aorganism%20%3Forg.%0D%0A%20%20%3Forg%20biopax3%3Aname%20%3Forgname.%0D%0A%20%20%7B%3Fpathway%20biopax3%3ApathwayComponent%20%3Fsubcomponent%7D%0D%0A%20%20UNION%0D%0A%20%20%7BOPTIONAL%7B%3Fsubcomponent%20biopax3%3ApathwayComponent%20%3Fsubcomponent%7D%7D%0D%0A%20%20%0D%0A%20%20%20%7BOPTIONAL%7B%3Fsubcomponent%20biopax3%3Aevidence%20%3Fevidencelist.%7D%7D%0D%0A%20%20UNION%0D%0A%20%20%7BOPTIONAL%7B%3Fpathway%20biopax3%3Aevidence%20%3Fevidencelist%7D%7D%0D%0A%0D%0A%20%20%7BOPTIONAL%7B%3Fevidencelist%20biopax3%3Axref%20%3Fpub.%7D%7D%0D%0A%20%20UNION%0D%0A%20%20%7BOPTIONAL%7B%3Fsubcomponent%20biopax3%3Axref%20%3Fpub%7D%7D%0D%0A%20%20UNION%0D%0A%20%20%7BOPTIONAL%7B%3Fpathway%20biopax3%3Axref%20%3Fpub%7D%7D%0D%0A%20%20%0D%0A%20%20%0D%0A%20%20%3Fpub%20rdf%3Atype%20biopax3%3APublicationXref.%0D%0A%20%20%3Fpub%20biopax3%3Adb%20%3Fpub_db.%0D%0A%20%20%3Fpub%20biopax3%3Aid%20%3Fpmid.%0D%0A%20%20FILTER%20regex(%3Fpub_db%2C%22Pubmed%22).%0D%0A%20%20FILTER%20(%3Fpathway%20%3D%20%20%3Chttp%3A%2F%2Fidentifiers.org%2Freactome%2F","%3E).%0D%0A%20%20%0D%0A%7D&format=CSV&inference=false"
        ar_temp_url = 'http://www.ebi.ac.uk/arrayexpress/xml/v2/experiments?pmid=';
        
        species_pw_list.pop()
        for i in species_pw_list:
            cur_pwid = i[2]
            cur_pwname = i[3]
            cur_query = query_sparql[0]+cur_pwid+query_sparql[1]
            request = Request(cur_query)
            try:
                
                f = open(file_name+".log","a");
                response = urlopen(request)
                cur_pmid_list = response.read()
                
                cur_pmid_list = cur_pmid_list[6:].replace("\r","").split("\n")
                cur_pmid_list.pop()
                print cur_pmid_list
                
                list_found = list();
                list_notfound = list();
                
                for j in cur_pmid_list:
                    ar_query = ar_temp_url+j
                    ar_request = Request(ar_query)
                    try:
                        ar_response = urlopen(ar_request)
                        result = ar_response.read()
                        is_found = ""
                        if (result == '<?xml version="1.0" encoding="UTF-8"?><experiments version="1.2" revision="100915" total="0" total-samples="0" total-assays="0"/>'):
        #                    print "not exist"
                            list_notfound.append(j)
                            is_found = "N" 
                        else:
        #                    print "exist"
                            list_found.append(j)
                            is_found = "Y"
                        f.write(cur_sp[0]+":::[PM]SUCCESS:::"+cur_pwname+ ":::"+cur_pwid+":::"+is_found+":::"+j+":::"+ar_query+"\n");
                        print cur_sp[0],":::[PM]SUCCESS:::",cur_pwname, ":::", cur_pwid, ":::",is_found,":::",j,":::",ar_query;
                    except URLError, e:
                        f.write(cur_sp[0]+":::"+"[PM]FAILED:::"+cur_pwname+ ":::"+cur_pwid+":::"+j+":::"+ar_query+"\n");
                        print cur_sp[0],":::","[PM]FAILED:::",cur_pwname, ":::", cur_pwid, ":::",i,":::",ar_query;
                f.write(cur_sp[0]+":::"+"[PW]SUCCESS:::"+cur_pwname+":::"+cur_pwid+":::"+str(len(list_found))+":::"+str(len(list_notfound))+":::"+cur_query+"\n")
                print cur_sp[0],":::","[PW]SUCCESS:::",cur_pwname,":::", cur_pwid,":::",len(list_found),":::",len(list_notfound),":::",cur_query;
                f.write(cur_sp[0]+":::"+"[PW_EXIST_LIST]:::")
                print cur_sp[0],":::","[PW_EXIST_LIST]:::",
                if (len(list_found) != 0):
                    f.write(list_found[0])
                    print list_found[0],
                for i in range(1,len(list_found)):
                    f.write(","+list_found[i])
                    print ",",list_found[i],
                f.write("\n")
                print;
                f.write(cur_sp[0]+":::"+"[PW_NOTEXIST_LIST]:::")
                print cur_sp[0],":::","[PW_NOTEXIST_LIST]:::",
                if (len(list_notfound) != 0):
                    f.write(list_notfound[0])
                    print list_notfound[0],
                for i in range(1,len(list_notfound)):
                    f.write(","+list_notfound[i])
                    print ",",list_notfound[i],
                f.write("\n")
                print;
                f.close()
            except URLError, e:
                f.write(cur_sp[0]+":::"+"[PW]FAILED:::"+cur_pwname+":::"+cur_pwid+":::"+cur_query+"\n");
                print cur_sp[0],":::","[PW]FAILED:::",cur_pwname,":::", cur_pwid,":::",cur_query;
                f.close()
    except URLError, e:
        f.write(cur_sp[0]+":::"+"[SP]FAILED\n");
        print cur_sp[0],":::","[SP]FAILED";
        f.close()        
    
